/*******************************************************************************
* File Name          : CANid-hex-bin.c
* Date First Issued  : 05/17/2024
* Board              : 
* Description        : CAN ID to<->from ascii/hex format and binary
*******************************************************************************/
#include <stdio.h>
#include <fcntl.h>
#include <stdint.h>
#include <stdlib.h>
static const int8_t h[256] =
{
/*   0   1   2   3   4   5   6   7   8   9   A   B   C   D   E   F  */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  0 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  1 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  2 */
	 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, -1, -1, -1, -1, -1, -1, /*  3 */
	-1, 10, 11, 12, 13, 14, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  4 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  5 */
	-1, 10, 11, 12, 13, 14, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  6 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  7 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  8 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  9 */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  A */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  B */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  C */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  D */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, /*  E */
	-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1  /*  F*/
};

/* **************************************************************************************
 * uint32_t CANid_hex_bin(char* pc);
 * @brief   : Convert CAN id from ascii/hex to unint32_t
 * @param   : pc = pointer to ascii/hex CAN msg
 * @return  : CAN id as uint32_t; 0 = invalid input
 * ************************************************************************************** */
 uint32_t CANid_hex_bin(char* pc)
 {
 	uint32_t id;
 	int8_t ret;
 	if ((ret=h[*(uint8_t*)(pc+0)]) < 0) return 0; 
 	id  = ret <<  4;
 	if ((ret=h[*(uint8_t*)(pc+1)]) < 0) return 0; 
 	id |= ret <<  0;
 	if ((ret=h[*(uint8_t*)(pc+2)]) < 0) return 0; 
 	id |= ret << 12;
 	if ((ret=h[*(uint8_t*)(pc+3)]) < 0) return 0; 
 	id |= ret <<  8;
 	if ((ret=h[*(uint8_t*)(pc+4)]) < 0) return 0; 
 	id |= ret << 20;
 	if ((ret=h[*(uint8_t*)(pc+5)]) < 0) return 0; 
 	id |= ret << 16;
 	if ((ret=h[*(uint8_t*)(pc+6)]) < 0) return 0; 
 	id |= ret << 28;
 	if ((ret=h[*(uint8_t*)(pc+7)]) < 0) return 0; 
 	id |= ret << 24;
 	return id;
 }
 /* **************************************************************************************
 * void CANid_bin_hex(char* pc, uint32_t id);
 * @brief   : Convert CAN id uint32_t to ascii/hex
 * @param   : pc = pointer to ascii/hex CAN msg
 * @param	: id = CAN id to be hexed
 * ************************************************************************************** */
 static const uint8_t b[16] = {'0','1','2','3','4','5','6','7','8','9','A','B','C','D','E','F'};
 void CANid_bin_hex(char* pc, uint32_t id)
 {
 	pc +=2; // Skip sequence byte; point to low ord CAN ID
 	*(pc+0) = b[(id >> 4) & 0xF];
 	*(pc+1) = b[(id >> 0) & 0xF];
 	*(pc+2) = b[(id >>12) & 0xF];
 	*(pc+3) = b[(id >> 8) & 0xF];
 	*(pc+4) = b[(id >>20) & 0xF];
 	*(pc+5) = b[(id >>16) & 0xF];
 	*(pc+6) = b[(id >>28) & 0xF];
 	*(pc+7) = b[(id >>24) & 0xF];
 	return;
 }